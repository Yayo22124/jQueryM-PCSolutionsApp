<!DOCTYPE html>
<html>

<head>
    <title>PCSolutions</title>
    <meta charset="utf-8">
    <!-- ! Description page -->
    <meta name="description" content="PCSolutions tu mejor opción para reparar tu computadora." />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css">
    <!-- CSS de Slick Carousel -->
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.css">
    <link rel="stylesheet" type="text/css"
        href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick-theme.css">
    <script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
    <script src="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
    <!-- Slick Carousel -->
    <script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.js"></script>
    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Sweet Alert -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
    <script src="https://cdn.jsdelivr.net/npm/uuid@8.3.2/dist/umd/uuidv4.min.js"></script>

</head>

<body>
    <!-- ! Inicio -->
    <div data-role="page" id="home" data-theme="b">
        <!-- *Header -->
        <div data-role="header" data-theme="b">
            <h1>Inicio</h1>
            <button onclick="getData()">Get Data</button>
        </div>

        <!-- ? Navbar  -->
        <div data-role="footer" data-position="fixed" data-theme="b">
            <div data-role="navbar">
                <ul>
                    <li><a href="#home" data-icon="home" data-transition="slide" data-ajax="false">Inicio</a></li>
                    <li><a href="#about" data-icon="grid" data-transition="slide" data-ajax="false">Citas Pendientes</a>
                    </li>
                    <li><a href="#contact" data-icon="star" data-transition="slide" data-ajax="false">Contacto</a></li>
                </ul>
            </div>
        </div>
        <!-- * Content -->
        <div data-role="content">
            <!-- Título y contenido -->
            <div class="flex flex-col items-center text-center text-balance mx-auto gap-5 mb-5">
                <h2 class="text-3xl text-sky-500/90 font-bold">PCSolutions</h2>
                <p><strong>Misión:</strong> Proveer servicios de reparación de equipos de cómputo con calidad y
                    eficiencia,
                    garantizando la satisfacción de nuestros clientes.</p>
                <p><strong>Visión:</strong> Ser reconocidos como líderes en el sector de reparación de equipos de
                    cómputo,
                    destacando por nuestra excelencia y compromiso con la satisfacción del cliente.</p>
            </div>

            <!-- Card con carrusel de imágenes -->
            <div data-role="collapsible" data-collapsed="false">
                <h4>Portafolio</h4>
                <div id="carrusel" class="slick-carousel w-3/4 mx-auto">
                    <!-- Imágenes del carrusel -->
                    <div><img src="./assets/img/pcsolutionsIMG1.jpg" alt="Imagen 1" class="w-[200px]"></div>
                    <div><img src="./assets/img/pcsolutionsIMG2.jpg" alt="Imagen 2" class="w-[200px]"></div>
                    <div><img src="./assets/img/pcsolutionsIMG3.jpg" alt="Imagen 3" class="w-[200px]"></div>
                    <div><img src="./assets/img/pcsolutionsIMG4.jpg" alt="Imagen 4" class="w-[200px]"></div>
                </div>
            </div>

            <!-- * buttons -->
            <div class="w-full flex mx-auto justify-around">
                <a href="#about" data-role="button" data-icon="info" data-transition="slide"
                    data-ajax="false">Nosotros</a>
                <a href="#contact" data-role="button" data-icon="phone" data-transition="slide"
                    data-ajax="false">Contáctanos</a>
            </div>
        </div>
    </div>
    </div>

    <!-- ! About -->
    <div data-role="page" id="about" data-theme="b">
        <!-- * Header -->
        <div data-role="header" data-theme="b">
            <h1>Citas Solicitadas</h1>
        </div>
        <!-- * Content -->
        <div data-role="content" data-theme="b" id="citas-container">
        </div>

        <!-- * Footer -->
        <div data-role="footer" data-position="fixed" data-theme="b">
            <div data-role="navbar">
                <ul>
                    <li><a href="#home" data-icon="home" data-transition="slide" data-ajax="false">Inicio</a></li>
                    <li><a href="#about" data-icon="grid" data-transition="slide" data-ajax="false">Citas Pendientes</a>
                    </li>
                    <li><a href="#contact" data-icon="star" data-transition="slide" data-ajax="false">Contacto</a></li>
                </ul>
            </div>
        </div>
    </div>

    <!-- ! Contact -->
    <div data-role="page" id="contact" data-theme="b">
        <!-- * Header -->
        <div data-role="header" data-theme="b">
            <h1>Contacto</h1>
        </div>
        <!-- * Content -->
        <div data-role="content" data-theme="b">
            <!-- Titulo -->
            <h3 class="text-xl font-bold">Envíanos un mensaje o vísitanos</h3>
            <!-- Información de Contacto -->
            <div data-role="collapsible" data-collapsed="false">
                <h3>Información de Contacto</h3>
                <p><strong>Dirección:</strong> Puebla, Juan Galindo, Nuevo Necaxa, Venustiano Carranza N# 112</p>
                <p><strong>Teléfono:</strong> <a href="tel:7641151920">764 115 1920</a></p>
                <p><strong>Correo Electrónico:</strong> <a href="mailto:ya-yo22124@outlook.com"
                        class="text-xs">ya-yo22124@outlook.com</a></p>
            </div>

            <!-- Formulario de Contacto -->
            <form id="contactForm">

                <label for="updateName">Nombre:</label>
                <input type="text" id="updateName" name="updateName" required>

                <label for="updateEmail">Correo Electrónico:</label>
                <input type="email" id=updateEmail" name="updateEmail" required>

                <label for="updateTitle">Asunto:</label>
                <input type="text" id="updateTitle" name="updateTitle" required>

                <label for="updateMessage">Mensaje:</label>
                <textarea id="updateMessage" name="updateMessage" required></textarea>

                <label for="updateDate">Fecha:</label>
                <input type="date" id="updateDate" name="updateDate" required>

                <input type="hidden" id="method" name="method" value="POST">

                <button type="button" class="mt-9" data-theme="a" onclick="enviarCita()">Enviar Cita</button>
            </form>


        </div>
        <!-- * Footer -->
        <div data-role="footer" data-position="fixed" data-theme="b">
            <div data-role="navbar">
                <ul>
                    <li><a href="#home" data-icon="home" data-transition="slide" data-ajax="false">Inicio</a></li>
                    <li><a href="#about" data-icon="grid" data-transition="slide" data-ajax="false">Citas Pendientes</a>
                    </li>
                    <li><a href="#contact" data-icon="star" data-transition="slide" data-ajax="false">Contacto</a></li>
                </ul>
            </div>
        </div>

    </div>


</body>
<script>
    const apiUrl = "https://pcsolutions-nest-api.onrender.com";

    $(document).on("pagecreate", "#home", function () {
        // Inicializa el carrusel con opciones de Slick Carousel
        $("#carrusel").slick({
            // Configuración del carrusel (puedes ajustar según tus necesidades)
            autoplay: true,
            dots: true,
            infinite: true,
            speed: 750,
            slidesToShow: 1,
            slidesToScroll: 1,
            centerMode: true,
            centerPadding: "4px",
            variableWidth: true
        });
    });


    async function getData() {
        let citas = [];
        await fetch(`${apiUrl}/citas`)
            .then(response => response.json())
            .then(data => {
                citas = data;
            });

        // Renderizar las citas en la página "Citas Pendientes"
        renderCitas(citas);
    }

    function renderCitas(citas) {
        const citasContainer = $("#citas-container");
        citasContainer.empty(); // Limpiar el contenedor antes de agregar nuevas citas

        citas.forEach(cita => {
            const citaHTML = `<div data-role="collapsible">
                                <h3>${cita.title}</h3>
                                <p><strong>Nombre:</strong> ${cita.name}</p>
                                <p><strong>Correo Eléctronio:</strong> ${cita.email}</p>
                                <p><strong>Descripción:</strong> ${cita.message}</p>
                                <p><strong>Fecha:</strong> ${cita.date}</p>
                                <button onclick="editarCita('${cita.id}')">Editar Cita</p>
                                <button onclick="eliminarCita('${cita.id}')">Eliminar Cita</p>
                            </div>`;
            citasContainer.append(citaHTML);
        });

        // Llama a 'refresh' después de agregar todos los elementos
        citasContainer.collapsibleset().trigger('create');
    }

    $(document).on("pageshow", "#about", function () {
        getData();
    });

    function editarCita(id) {
        // Obtener los datos de la cita para cargar en el formulario de actualización
        getCitaById(id).then(cita => {
            // Llenar el formulario de actualización con los datos de la cita
            $("#updateId").val(cita.id);
            $("#updateName").val(cita.name);
            $("#updateEmail").val(cita.email);
            $("#updateTitle").val(cita.title);
            $("#updateMessage").val(cita.message);
            $("#updateDate").val(cita.date);

            // Mostrar el div con el formulario de actualización
            $("#updateFormDiv").show();

            // Establecer el método como PUT para indicar que es una actualización
            $("#method").val("PUT");

            // Mostrar un mensaje para indicar que está en modo de edición
            mostrarMensaje("Editando Cita", "info");
        }).catch(error => {
            console.error("Error al obtener la cita para editar:", error);
            mostrarMensaje("Error al obtener la cita para editar", "error");
        });
    }


    function eliminarCita(id) {
        // Preguntar al usuario para confirmar la eliminación
        Swal.fire({
            title: '¿Estás seguro?',
            text: 'Esta acción no se puede revertir',
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Sí, eliminar'
        }).then((result) => {
            if (result.isConfirmed) {
                // Llamar a la función para eliminar la cita
                eliminarCitaConfirmada(id);
            }
        });
    }

    function eliminarCitaConfirmada(id) {
        // Enviar la solicitud DELETE al servidor
        $.ajax({
            type: "DELETE",
            url: `${apiUrl}/citas/${id}`, // Reemplaza con la URL correcta de tu API
            success: function (response) {
                console.log("Cita eliminada con éxito:", response);
                mostrarMensaje("Cita eliminada con éxito", "success");

                // Recargar las citas después de eliminar una
                getData();
            },
            error: function (error) {
                console.error("Error al eliminar la cita:", error);
                mostrarMensaje("Error al eliminar la cita", "error");
                // Manejar el error según tus necesidades
            }
        });
    }


    function getCitaById(id) {
        // Hacer una solicitud GET a la API para obtener los datos de una cita por su ID
        return new Promise((resolve, reject) => {
            $.ajax({
                type: "GET",
                url: `${apiUrl}/citas/${id.stringify}`,
                success: function (response) {
                    resolve(response);
                },
                error: function (error) {
                    reject(error);
                }
            });
        });
    }

    function enviarCita() {
        // Obtener los datos del formulario
        const formData = $("#contactForm").serializeArray();

        // Crear un objeto con los datos del formulario
        const dataObject = {};
        formData.forEach(field => {
            dataObject[field.name] = field.value;
        });

        // Generar un ID aleatorio utilizando la biblioteca uuid
        dataObject.id = uuidv4();

        // Establecer el status como true por defecto
        dataObject.status = true;

        // Enviar la solicitud POST al servidor
        $.ajax({
            type: "POST",
            url: `${apiUrl}/citas`, // Reemplaza con la URL correcta de tu API
            contentType: "application/json",
            data: JSON.stringify(dataObject),
            success: function (response) {
                console.log("Cita enviada con éxito:", response);
                mostrarMensaje("Cita enviada con éxito", "success");
                // Puedes realizar acciones adicionales después de enviar la cita, si es necesario
            },
            error: function (error) {
                console.error("Error al enviar la cita:", error);
                mostrarMensaje("Error al enviar la cita", "error");
                // Manejar el error según tus necesidades
            }
        });

        $("#name").val("");
        $("#email").val("");
        $("#title").val("");
        $("#message").val("");
        $("#date").val("");
    }

    function mostrarMensaje(mensaje, tipo) {
        Swal.fire({
            icon: tipo === 'success' ? 'success' : 'error',
            title: mensaje,
            showConfirmButton: false,
            timer: 2000  // Ajusta el tiempo de visualización del mensaje
        });
    }
</script>

</html>